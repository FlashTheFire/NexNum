# =============================================================================
# ALERTMANAGER CONFIGURATION (Unified v2.0)
# =============================================================================

global:
  resolve_timeout: 5m
  smtp_smarthost: 'smtp.gmail.com:587'
  smtp_from: 'harshtakur001@gmail.com'
  smtp_auth_username: 'harshtakur001@gmail.com'
  smtp_auth_password: 'bfqh mije jisu jmcf'
  smtp_require_tls: true

route:
  group_by: ['alertname', 'severity']
  group_wait: 30s
  group_interval: 2m
  repeat_interval: 4h
  receiver: 'ops-telegram'

  routes:
    # Route all critical alerts to urgent channels
    - match:
        severity: critical
      receiver: 'ops-telegram-critical'
      repeat_interval: 1h

receivers:
  # General Operations Channel (Telegram)
  - name: 'ops-telegram'
    webhook_configs:
      - url: 'http://host.docker.internal:3000/api/alerts/telegram'
        send_resolved: true

        http_config:
          bearer_token: "nexnum-internal-monitoring-secret-9912"

  # Emergency Channel (Telegram + Email Backup)
  - name: 'ops-telegram-critical'
    webhook_configs:
      - url: 'http://host.docker.internal:3000/api/alerts/telegram'
        send_resolved: true

        http_config:
          bearer_token: "nexnum-internal-monitoring-secret-9912"

    email_configs:
      - to: 'admin@nexnum.com'
        send_resolved: true
        headers:
          Subject: 'ðŸš¨ [NEXNUM-CRITICAL] {{ .GroupLabels.alertname }}'

